<!DOCTYPE html>
<html layout:decorate="~{th/layout}">
<div layout:fragment="content">

  <h1>장바구니 목록</h1>

  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th style="text-align: left; padding: 10px;">상품 정보</th>
        <th style="text-align: center; padding: 10px;">수량</th>
        <th style="text-align: right; padding: 10px;">판매가</th>
        <th style="text-align: right; padding: 10px;">총 금액</th>
        <th style="text-align: center; padding: 10px;">삭제</th>
      </tr>
    </thead>
    <tbody>
      <!-- 장바구니 항목 반복 -->
      <tr th:each="cart : ${cartList}" style="border-bottom: 1px solid #ddd;">
        <!-- 상품 이미지 및 이름 -->
        <td style="padding: 10px;">
          <img th:src="@{|/menu/storage/${cart.photo}|}" alt="이미지" style="width: 80px; vertical-align: middle;" />
          <span th:text="${cart.name}" style="margin-left: 10px; vertical-align: middle;"></span>
        </td>
        <!-- 수량 조절 -->
        <!-- 수량 조절 버튼 -->
        <td style="text-align: center;">
            <button th:value="${cart.cartno}" th:onclick="'updatecnt(\'minus\', ' + ${cart.cartno} + ')'"> - </button>
            <span id="quantity-${cart.cartno}" th:text="${cart.cnt}" style="margin: 0 10px;"></span>
            <button th:value="${cart.cartno}" th:onclick="'updatecnt(\'plus\', ' + ${cart.cartno} + ')'"> + </button>
        </td>
        <!-- 판매가 -->
        <td style="text-align: right;" th:text="${cart.saleprice + '원'}"></td>
        <!-- 총 금액 -->
        <td style="text-align: right;" th:text="${cart.saleprice * cart.cnt + '원'}"></td>
        <!-- 삭제 버튼 -->
        <td style="text-align: center;">
          <form method="post" th:action="@{/th/cart/delete}">
            <input type="hidden" name="cartno" th:value="${cart.cartno}" />
            <input type="hidden" name="memberno" th:value="${cart.memberno}" />
            <button type="submit" style="color: red;">삭제</button>
          </form>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- 배송비 및 총 결제 금액 -->
  <div style="margin-top: 20px;">
    <div style="display: flex; justify-content: space-between; padding: 10px 0; border-top: 1px solid #ddd;">
      <span>배송비</span>
      <span th:text="${deliveryFee == 0 ? '무료배송' : (deliveryFee + '원')}"></span>
    </div>
    <div style="display: flex; justify-content: space-between; padding: 10px 0;">
      <span>총 상품 금액</span>
      <span th:text="${totalPrice + '원'}"></span>
    </div>
    <div style="display: flex; justify-content: space-between; font-weight: bold; padding: 10px 0;">
      <span>총 결제 금액</span>
      <span th:text="${finalPrice + '원'}"></span>
    </div>
  </div>

  <!-- 주문하기 버튼 -->
  <div style="text-align: center; margin-top: 20px;">
    <button style="padding: 10px 20px; background-color: #00c8c8; color: white; border: none; border-radius: 5px; font-size: 16px;">
      주문하기
    </button>
  </div>
  
  <!-- JavaScript 코드 -->
  <script>
  df
  function updatecnt(operation, cartno) { 
    data={
      operation : operation,
      cartno : cartno
    }
  
    // ajax 기본 형식
    fetch('/th/cart/updatecnt', {
      method : 'POST',
      headers : {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(data => {
      
      console.log(data);
  
    })
    .catch(error => { // 통신 자체를 실패
      console.error('추가 실패 : ', error);
    });
    
  }
  
}
  
  </script>
  <!-- JavaScript 코드 -->
</div>

</html>
