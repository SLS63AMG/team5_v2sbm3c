<!-- 
  다른 템플릿에서:
    <div th:replace="~{menu/list_all_com :: list_all_fragment}"></div>
  형태로 불러올 수 있도록, 아래처럼 th:fragment 정의
-->
<div th:fragment="list_all_fragment">
  <table class="table table-hover" style="width: 100%;">
    <colgroup>
      <col style="width: 10%;" />  <!-- menuno or 순번 -->
      <col style="width: 15%;" />  <!-- name -->
      <col style="width: 25%;" />  <!-- explanation -->
      <col style="width: 10%;" />  <!-- price -->
      <col style="width: 10%;" />  <!-- storeno -->
      <col style="width: 10%;" />  <!-- 수정/삭제 버튼 -->
    </colgroup>
    <thead>
      <tr>
        <th>번호</th>
        <th>메뉴명</th>
        <th>설명</th>
        <th>가격</th>
        <th>식당번호</th>
        <th>관리</th> <!-- 수정/삭제 버튼 -->
      </tr>
    </thead>
    <tbody>
      <tr th:each="menuVO : ${list}">
        <!-- 메뉴 번호 -->
        <td th:text="${menuVO.menuno}"></td>

        <!-- 메뉴명 -->
        <td>
          <a th:href="@{/th/menu/read/{menuno}(menuno=${menuVO.menuno})}"
             style="display:block;"
             th:text="${menuVO.name}">메뉴명</a>
        </td>

        <!-- 설명 -->
        <td th:text="${menuVO.explanation}"></td>

        <!-- 가격 -->
        <td th:text="${menuVO.price}"></td>

        <!-- 식당 번호 -->
        <td th:text="${menuVO.storeno}"></td>

        <!-- 수정 및 삭제 -->
        <td>
          <!-- 수정 버튼 -->
          <a th:href="@{/th/menu/update/{menuno}(menuno=${menuVO.menuno})}">
            <button class="btn btn-sm btn-warning">수정</button>
          </a>

          <!-- 삭제 버튼 -->
          <a th:href="@{/th/menu/delete/{menuno}(menuno=${menuVO.menuno})}" onclick="return confirm('정말 삭제하시겠습니까?');">
            <button class="btn btn-sm btn-danger">삭제</button>
          </a>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- 페이징 UI 필요 시 추가 -->
  <div class="Bottom_menu" th:utext="${paging}"></div>
</div>

<script>
  // 추천 수 증가/취소 AJAX
  function toggleRecom(menuno, memberno) {
    if (!memberno) {
      alert('로그인이 필요합니다.');
      return;
    }

    fetch(`/th/menurecom/recommend`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ menuno: menuno, memberno: memberno })
    })
      .then(response => {
        if (!response.ok) {
          throw new Error('추천 요청 실패');
        }
        return response.json();
      })
      .then(data => {
        const countElement = document.getElementById(`recom-count-${menuno}`);
        countElement.textContent = data.newRecomCount; // 서버에서 반환된 추천 수로 갱신
        alert(data.message); // 추천 상태에 따른 메시지 표시
      })
      .catch(error => {
        console.error('오류:', error);
        alert('추천 요청에 실패했습니다.');
      });
  }
</script>

