<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dev.mvc.categrp.CategrpDAOInter">

  <!-- 카테고리 그룹 생성 -->
  <insert id="create" parameterType="dev.mvc.categrp.CategrpVO">
    INSERT INTO categrp (categrpno, name, rdate)
    VALUES (categrp_seq.nextval, #{name}, sysdate)
  </insert>

  <!-- 모든 카테고리 그룹 목록 -->
  <select id="list_all" resultType="dev.mvc.categrp.CategrpVO">
    SELECT categrpno, name, rdate
    FROM categrp
    ORDER BY categrpno ASC
  </select>

  <!-- 특정 카테고리 그룹 읽기 -->
  <select id="read" resultType="dev.mvc.categrp.CategrpVO" parameterType="Integer">
    SELECT categrpno, name, rdate
    FROM categrp
    WHERE categrpno = #{categrpno}
  </select>

  <!-- 카테고리 그룹 수정 -->
  <update id="update" parameterType="dev.mvc.categrp.CategrpVO">
    UPDATE categrp
    SET name = #{name}, rdate = sysdate
    WHERE categrpno = #{categrpno}
  </update>

  <!-- 카테고리 그룹 삭제 -->
  <delete id="delete" parameterType="Integer">
    DELETE FROM categrp
    WHERE categrpno = #{categrpno}
  </delete>

  <!-- 이름으로 검색 -->
  <select id="list_search" resultType="dev.mvc.categrp.CategrpVO" parameterType="String">
    SELECT categrpno, name, rdate
    FROM categrp
    <if test="word != null and word != ''">
      WHERE UPPER(name) LIKE '%' || UPPER(#{word}) || '%'
    </if>
    ORDER BY categrpno ASC
  </select>

  <!-- 검색 결과 개수 -->
  <select id="list_search_count" resultType="Integer" parameterType="String">
    SELECT COUNT(*) AS cnt
    FROM categrp
    <if test="word != null and word != ''">
      WHERE UPPER(name) LIKE '%' || UPPER(#{word}) || '%'
    </if>
  </select>

  <!-- 그룹 번호 기반 카운트 증가 -->
  <update id="incrementCategrpCount" parameterType="Integer">
    UPDATE categrp
    SET rdate = sysdate
    WHERE categrpno = #{categrpno}
  </update>

</mapper>
